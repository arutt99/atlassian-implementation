<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atlassian Pricing Estimator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .module {
            cursor: grab;
            transition: all 0.2s ease-in-out;
        }
        .module:active {
            cursor: grabbing;
            transform: scale(1.05);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .drop-zone {
            transition: background-color 0.2s ease-in-out;
        }
        .drop-zone.drag-over {
            background-color: #dbeafe; /* light blue */
            border-style: dashed;
        }
        .modal-backdrop {
            background-color: rgba(0,0,0,0.5);
        }
        .remove-btn {
            font-size: 1.5rem;
            line-height: 1;
            font-weight: bold;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-blue-600">Atlassian Pricing Estimator</h1>
            <p class="text-gray-500 mt-2">Drag and drop modules to build your implementation plan.</p>
        </header>

        <div class="flex flex-col md:flex-row gap-8">

            <!-- Available Modules -->
            <div id="modules-container" class="w-full md:w-1/3 bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                <h2 class="text-xl font-semibold mb-4 border-b pb-2 text-gray-700">Available Modules</h2>
                <div id="modules" class="space-y-3">
                    <!-- Modules will be injected here by JavaScript -->
                </div>
            </div>

            <!-- Implementation Area -->
            <div id="implementation-area" class="w-full md:w-2/3 bg-white p-6 rounded-xl shadow-sm drop-zone border-2 border-dashed border-gray-300">
                <h2 class="text-xl font-semibold mb-4 border-b pb-2 text-gray-700">Implementation</h2>
                <div id="implementation-list" class="min-h-[400px] space-y-3">
                    <p id="drop-placeholder" class="text-center text-gray-400 mt-16">Drop modules here</p>
                </div>
                <div class="mt-6 pt-4 border-t border-gray-200">
                    <div class="text-right">
                        <p class="text-lg font-semibold text-gray-700">Total Estimated Cost: <span id="total-cost" class="text-2xl font-bold text-blue-600">$0</span></p>
                        <p class="text-md font-medium text-gray-500">Total Hours: <span id="total-hours" class="font-semibold">0</span></p>
                    </div>
                    <div class="mt-6 text-right">
                        <button id="export-btn" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition duration-300">
                            Export to Excel
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for custom inputs -->
    <div id="modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop">
        <div class="bg-white rounded-lg shadow-xl p-6 w-11/12 md:w-1/3 border border-gray-200">
            <h3 id="modal-title" class="text-lg font-medium leading-6 text-gray-900 mb-4"></h3>
            <div id="modal-body" class="space-y-4">
                <!-- Dynamic form fields will be injected here -->
            </div>
            <div class="mt-6 flex justify-end space-x-3">
                <button id="modal-cancel" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300">Cancel</button>
                <button id="modal-save" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Save</button>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Module Data with Updated Prices ---
            const modules = [
                { id: 'initial_setup', name: 'Initial Setup', price: 3000 },
                { id: 'sso_provisioning', name: 'SSO/User Provisioning', price: 6000 },
                { id: 'incident_management', name: 'Incident Management', price: 12000 },
                { id: 'service_management', name: 'Service Management', price: 18000 },
                { id: 'change_management', name: 'Change Management', price: 10000 },
                { id: 'problem_management', name: 'Problem Management', price: 6000 },
                { id: 'asset_management', name: 'Asset Management', price: 25000 },
                { id: 'knowledge_management', name: 'Knowledge Management', price: 3000 },
                { id: 'integrations', name: 'Integrations', price: 0, custom: 'both' }, // Special case
                { id: 'training', name: 'Training', price: 10000 },
                { id: 'reporting', name: 'Reporting', price: 12000 },
                { id: 'config_warranty', name: 'Configuration Warranty', price: 2500 },
                { id: 'licensing', name: 'Licensing', price: 0, custom: 'price' } // Special case
            ];

            // --- Element Selectors ---
            const modulesContainer = document.getElementById('modules');
            const implementationArea = document.getElementById('implementation-area');
            const implementationList = document.getElementById('implementation-list');
            const dropPlaceholder = document.getElementById('drop-placeholder');
            const totalCostEl = document.getElementById('total-cost');
            const totalHoursEl = document.getElementById('total-hours');
            const modal = document.getElementById('modal');
            const modalTitle = document.getElementById('modal-title');
            const modalBody = document.getElementById('modal-body');
            const modalCancel = document.getElementById('modal-cancel');
            const modalSave = document.getElementById('modal-save');
            const exportBtn = document.getElementById('export-btn');

            let draggedItem = null;
            let currentCustomData = {};

            // --- Initialize Modules ---
            function renderModules() {
                modulesContainer.innerHTML = '';
                modules.forEach(module => {
                    const moduleEl = createModuleElement(module);
                    modulesContainer.appendChild(moduleEl);
                });
            }

            function createModuleElement(module) {
                const div = document.createElement('div');
                div.className = 'module bg-white border border-gray-200 p-4 rounded-lg shadow-sm hover:shadow-md hover:border-blue-500 hover:bg-blue-50';
                div.setAttribute('draggable', 'true');
                div.dataset.id = module.id;
                div.dataset.name = module.name;
                div.dataset.price = module.price;
                if (module.custom) {
                    div.dataset.custom = module.custom;
                }
                div.innerHTML = `<span class="font-medium">${module.name}</span>`;
                return div;
            }

            // --- Drag and Drop Logic ---
            modulesContainer.addEventListener('dragstart', e => {
                if (e.target.classList.contains('module')) {
                    draggedItem = e.target;
                    setTimeout(() => {
                        e.target.style.opacity = '0.5';
                    }, 0);
                }
            });

            document.addEventListener('dragend', e => {
                if (draggedItem) {
                    draggedItem.style.opacity = '1';
                    draggedItem = null;
                }
            });

            implementationArea.addEventListener('dragover', e => {
                e.preventDefault();
                implementationArea.classList.add('drag-over');
            });

            implementationArea.addEventListener('dragleave', () => {
                implementationArea.classList.remove('drag-over');
            });

            implementationArea.addEventListener('drop', e => {
                e.preventDefault();
                implementationArea.classList.remove('drag-over');
                if (draggedItem) {
                    const moduleId = draggedItem.dataset.id;
                    const moduleName = draggedItem.dataset.name;
                    const modulePrice = parseFloat(draggedItem.dataset.price);
                    const moduleCustom = draggedItem.dataset.custom;

                    if (moduleCustom) {
                        currentCustomData = { id: moduleId, name: moduleName, price: modulePrice, custom: moduleCustom };
                        showModal(moduleCustom, moduleName);
                    } else {
                        addModuleToImplementation({ id: moduleId, name: moduleName, price: modulePrice });
                    }
                }
            });

            // --- Modal Logic ---
            function showModal(type, name) {
                modalTitle.textContent = `Configure ${name}`;
                modalBody.innerHTML = ''; // Clear previous content

                if (type === 'price' || type === 'both') {
                    modalBody.innerHTML += `
                        <div>
                            <label for="custom-price" class="block text-sm font-medium text-gray-700">Price ($)</label>
                            <input type="number" id="custom-price" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" placeholder="Enter custom price">
                        </div>
                    `;
                }
                if (type === 'both') {
                     modalBody.innerHTML += `
                        <div>
                            <label for="custom-description" class="block text-sm font-medium text-gray-700">Description</label>
                            <input type="text" id="custom-description" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" placeholder="e.g., Jira to Slack Integration">
                        </div>
                    `;
                }
                modal.style.display = 'flex';
            }

            function hideModal() {
                modal.style.display = 'none';
                currentCustomData = {};
            }

            modalCancel.addEventListener('click', hideModal);

            modalSave.addEventListener('click', () => {
                const customPriceEl = document.getElementById('custom-price');
                const customDescriptionEl = document.getElementById('custom-description');

                let price = currentCustomData.price || 0;
                if (customPriceEl && customPriceEl.value) {
                    const parsedPrice = parseFloat(customPriceEl.value);
                    if (!isNaN(parsedPrice)) {
                        price = parsedPrice;
                    }
                }

                let description = '';
                if (customDescriptionEl && customDescriptionEl.value) {
                    description = customDescriptionEl.value;
                }

                const moduleData = {
                    id: currentCustomData.id,
                    name: currentCustomData.name,
                    price: price,
                    description: description,
                };

                addModuleToImplementation(moduleData);
                hideModal();
            });


            // --- Implementation List Logic ---
            function addModuleToImplementation(moduleData) {
                dropPlaceholder.style.display = 'none';

                const item = document.createElement('div');
                item.className = 'bg-gray-50 border border-gray-200 p-4 rounded-lg flex justify-between items-center shadow-sm';
                item.dataset.price = moduleData.price;

                let descriptionHTML = '';
                if(moduleData.description) {
                    descriptionHTML = `<p class="text-sm text-gray-500">${moduleData.description}</p>`;
                }

                item.innerHTML = `
                    <div>
                        <p class="font-medium text-gray-800">${moduleData.name}</p>
                        ${descriptionHTML}
                    </div>
                    <div class="flex items-center gap-4">
                        <span class="font-semibold text-lg text-gray-900">$${moduleData.price.toLocaleString()}</span>
                        <button class="remove-btn text-gray-400 hover:text-red-600 transition-colors duration-200">&times;</button>
                    </div>
                `;

                // For integrations, we want to add a unique ID to each instance
                if (moduleData.id === 'integrations') {
                    item.dataset.id = `integrations_${new Date().getTime()}`;
                } else {
                    item.dataset.id = moduleData.id;
                    // Prevent non-integration modules from being added more than once
                    const existing = implementationList.querySelector(`[data-id="${moduleData.id}"]`);
                    if (existing) {
                        // Show a temporary message to the user
                        const messageBox = document.createElement('div');
                        messageBox.className = 'fixed top-5 right-5 bg-amber-100 text-amber-800 p-3 rounded-lg shadow-lg border border-amber-200 animate-pulse';
                        messageBox.textContent = `${moduleData.name} is already in the list.`;
                        document.body.appendChild(messageBox);
                        setTimeout(() => messageBox.remove(), 3000);
                        return;
                    }
                }

                implementationList.appendChild(item);
                updateTotalCost();
            }

            implementationList.addEventListener('click', e => {
                if (e.target.classList.contains('remove-btn')) {
                    e.target.closest('.bg-gray-50').remove();
                    updateTotalCost();
                    // Check if only the placeholder is left
                    if (implementationList.children.length === 1 && implementationList.children[0].id === 'drop-placeholder') {
                        dropPlaceholder.style.display = 'block';
                    }
                }
            });

            // --- Cost Calculation ---
            function updateTotalCost() {
                let total = 0;
                const items = implementationList.querySelectorAll('[data-price]');
                items.forEach(item => {
                    total += parseFloat(item.dataset.price);
                });
                const hours = total / 250;
                totalCostEl.textContent = `$${total.toLocaleString()}`;
                totalHoursEl.textContent = hours.toLocaleString(undefined, { minimumFractionDigits: 1, maximumFractionDigits: 1 });
            }

            // --- Excel Export ---
            function exportToExcel() {
                const items = implementationList.querySelectorAll('.bg-gray-50');
                if (items.length === 0) {
                    alert("There are no items to export.");
                    return;
                }

                const data = [];
                items.forEach(item => {
                    const name = item.querySelector('.font-medium').textContent;
                    const price = parseFloat(item.dataset.price);

                    data.push({
                        'Module': `${name} Discovery`,
                        'Price': price * 0.25
                    });
                    data.push({
                        'Module': `${name} Configuration`,
                        'Price': price * 0.50
                    });
                    data.push({
                        'Module': `${name} Validation`,
                        'Price': price * 0.25
                    });
                });

                const worksheet = XLSX.utils.json_to_sheet(data);
                const workbook = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(workbook, worksheet, 'Implementation Plan');

                // Style the headers
                worksheet['A1'].s = { font: { bold: true } };
                worksheet['B1'].s = { font: { bold: true } };

                // Set column widths
                worksheet['!cols'] = [{ wch: 50 }, { wch: 15 }];


                XLSX.writeFile(workbook, 'Atlassian_Implementation_Plan.xlsx');
            }

            exportBtn.addEventListener('click', exportToExcel);

            // --- Initial Render ---
            renderModules();
        });
    </script>

</body>
</html>
